<div id="levelTabs" class="scroll-tabs mt-4 mb-3 border-bottom">
  <% tabs = ["長文", "リスニング", "お気に入り"] %>
  <% tabs.each_with_index do |series, i| %>
    <button class="tab <%= 'active' if i.zero? %>" data-target="<%= series.downcase %>">
      <%= series %>
    </button>
  <% end %>
</div>

  <!-- タブコンテンツ -->
    <div class="tab-content w-100 d-flex flex-column align-items-center">
      <% tabs.each_with_index do |series, i| %>
        <div id="<%= series.downcase %>" class="tab-pane <%= 'active' if i.zero? %>" style="max-width: 700px; width: 100%;">

          <% chapters_to_show = if series == "お気に入り"
                                  current_user.favorited_audios.includes(:chapter).map(&:chapter).uniq
                                else
                                  @chapters.where(series: series)
                                end %>

          <% chapters_to_show.each do |chapter| %>
            <% audio = chapter.audios.first %>
            <div class="episode-card d-flex justify-content-between align-items-center mb-3 p-2 border rounded shadow-sm"
                id="<%= dom_id(chapter, :episode_card) %>">

              <!-- エピソードタイトル -->
              <div class="episode-info flex-grow-1">
                <h5 class="episode-title mb-1" style="font-size: 0.95rem;">
                  <%= audio ? link_to(chapter.title, textbook_chapter_audio_path(@textbook, chapter, audio), style: "text-decoration: none; color: inherit;") : chapter.title %>
                </h5>
              </div>

              <!-- お気に入りボタン -->
              <%= render "audios/favorite_button", audio: audio, chapter: chapter %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
